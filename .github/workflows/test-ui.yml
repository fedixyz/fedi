name: UI Checks
on:
    workflow_dispatch:
    pull_request:
        paths:
            - 'ui/**'

jobs:
    test-ui:
        name: Build UI workspace
        runs-on: [self-hosted, linux]
        steps:
            - name: Checkout repo
              uses: actions/checkout@v4

            - uses: cachix/install-nix-action@v30
              with:
                  nix_path: nixpkgs=channel:nixos-23.05

            - uses: cachix/cachix-action@v15
              with:
                  name: fedibtc
                  authToken: '${{ secrets.CACHIX_AUTH_TOKEN }}'

            - name: Build UI Dependencies
              run: nix develop -c ./scripts/ui/build-deps.sh

            - name: Run linter and test suites
              run: nix develop -c ./scripts/ci/test-ui.sh

            - name: Generate JS bundle for React Native
              run: nix develop -c ./scripts/ci/test-metro.sh

            - name: Check code formatting
              run: nix develop -c ./scripts/ci/check-ui-code-formatting.sh
